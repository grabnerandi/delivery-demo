apiVersion: v2
actions:
  - name: Run locust
    events:
      - name: sh.keptn.event.test.triggered
        jsonpath:
          property: $.data.test.teststrategy
          match: performance
    tasks:
      - name: Run locust smoke tests
        files:
          - locust/load.py
          - locust/locust.conf
        image: locustio/locust:2.8.4
        env:
          - name: DEPLOYMENTURL
            value: "$.data.deployment.deploymentURIsPublic[0]"
            valueFrom: event
        cmd:
          - locust
        args:
          - '--headless'
          - '--host'
          - '$(DEPLOYMENTURL)'
          - '--locustfile'
          - '/keptn/locust/load.py'
          - '--config'
          - '/keptn/locust/locust.conf'
